
<!DOCTYPE html>
<html lang="en-US">
<!--
    Copyright (c) 1999-2017 by Digital Mars
    All Rights Reserved Written by Walter Bright
    http://digitalmars.com
  -->
<head>
<meta charset="utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>Floating Point - D Programming Language</title>

<link rel="stylesheet" href="css/codemirror.css" />
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/print.css" media="print" />
<link rel="stylesheet" href="css/cssmenu.css">
<link rel="shortcut icon" href="favicon.ico" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=10.0" />

</head>
<body id='Floating Point' class='doc'>
<script type="text/javascript">document.body.className += ' have-javascript'</script>
<div id="top">	<div id="header">		<img src="images/hamburger.svg" id="mobile-hamburger">
		<a class="logo" href="."><img id="logo" width="125" height="95" alt="D Logo" src="images/dlogo.svg"></a>
		<span id="d-language-mobilehelper"><a href="." id="d-language">D Programming Language</a></span>
	</div>
</div>
<div id="navigation">    
    <div id="search-box">        <form method="get" action="http://google.com/search">
            <input type="hidden" id="domains" name="domains" value="dlang.org" />
            <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
            <span id="search-query"><input id="q" name="q" placeholder="Search" tabindex="1000" /></span><span id="search-dropdown">                <select id="sitesearch" name="sitesearch" size="1">
                    <option value="dlang.org">Entire D Site</option>
                    <option  value="dlang.org/phobos">Library Reference</option>
                    <option  value="forum.dlang.org">Discussion Forums</option>
                    
                </select>
            </span><span id="search-submit"><button type="submit"><i class="fa fa-search"></i><span>go</span></button></span>
        </form>
    </div>
    
<div id="cssmenu"><ul>    <li><a href='index.html'><span>D 2.069.0</span></a></li>
    <li><a href='download.html'><span><b>Download</b></span></a></li>
    <li><a href='getstarted.html'><span>Getting Started</span></a></li>
    <li><a href='changelog/2.069.0.html'><span>Change Log</span></a></li>
    <li class='has-sub'><a href='#'><span>D Reference</span></a>
      <ul><li><a href='        intro.html'>Introduction</a></li><li><a href='        lex.html'>Lexical</a></li><li><a href='        grammar.html'>Grammar</a></li><li><a href='        module.html'>Modules</a></li><li><a href='        declaration.html'>Declarations</a></li><li><a href='        type.html'>Types</a></li><li><a href='        property.html'>Properties</a></li><li><a href='        attribute.html'>Attributes</a></li><li><a href='        pragma.html'>Pragmas</a></li><li><a href='        expression.html'>Expressions</a></li><li><a href='        statement.html'>Statements</a></li><li><a href='        arrays.html'>Arrays</a></li><li><a href='        hash-map.html'>Associative Arrays</a></li><li><a href='        struct.html'>Structs and Unions</a></li><li><a href='        class.html'>Classes</a></li><li><a href='        interface.html'>Interfaces</a></li><li><a href='        enum.html'>Enums</a></li><li><a href='        const3.html'>Const and Immutable</a></li><li><a href='        function.html'>Functions</a></li><li><a href='        operatoroverloading.html'>Operator Overloading</a></li><li><a href='        template.html'>Templates</a></li><li><a href='        template-mixin.html'>Template Mixins</a></li><li><a href='        contracts.html'>Contract Programming</a></li><li><a href='        version.html'>Conditional Compilation</a></li><li><a href='        traits.html'>Traits</a></li><li><a href='        errors.html'>Error Handling</a></li><li><a href='        unittest.html'>Unit Tests</a></li><li><a href='        garbage.html'>Garbage Collection</a></li><li><a href='        float.html'>Floating Point</a></li><li><a href='        iasm.html'>D x86 Inline Assembler</a></li><li><a href='        ddoc.html'>Embedded Documentation</a></li><li><a href='        interfaceToC.html'>Interfacing to C</a></li><li><a href='        cpp_interface.html'>Interfacing to C++</a></li><li><a href='        objc_interface.html'>Interfacing to Objective-C</a></li><li><a href='        portability.html'>Portability Guide</a></li><li><a href='        entity.html'>Named Character Entities</a></li><li><a href='        memory-safe-d.html'>Memory Safety</a></li><li><a href='        abi.html'>Application Binary Interface</a></li><li><a href='        simd.html'>Vector Extensions
      </a></li></ul>
    <li><a href='phobos/index.html'><span>Standard library</span></a></li>
    <li><a href='http://code.dlang.org'><span>DUB &ndash; The D package registry</span></a></li>
    <li class='has-sub'><a href='#'><span>Community</span></a>
      <ul><li><a href='        bugstats.php'>Bug Tracker</a></li><li><a href='        http://forum.dlang.org'>Forums</a></li><li><a href='        irc://irc.freenode.net/d'>IRC</a></li><li><a href='        http://github.com/D-Programming-Language'>D on GitHub</a></li><li><a href='        http://wiki.dlang.org'>Wiki</a></li><li><a href='        http://wiki.dlang.org/Review_Queue'>Review Queue</a></li><li><a href='        http://twitter.com/search?q=%23dlang'>Twitter</a></li><li><a href='        http://digitalmars.com/d/dlinks.html'>More Links
      </a></li></ul>
    <li class='has-sub'><a href='#'><span>Compilers &amp; Tools</span></a>
      <ul><li><a href='        dmd-windows.html'>dmd &ndash; reference compiler</a></li><li><a href='        http://gdcproject.org'>gdc &ndash; gcc-based compiler</a></li><li><a href='        http://wiki.dlang.org/LDC'>ldc &ndash; LLVM-based compiler</a></li><li><a href='        http://code.dlang.org/download'>DUB &ndash; D package manager</a></li><li><a href='        https://github.com/Hackerpilot/dfix'>dfix &ndash; D source code upgrade</a></li><li><a href='        https://github.com/Hackerpilot/dfmt'>dfmt &ndash; D source code formatting tool</a></li><li><a href='        rdmd.html'>rdmd &ndash; build tool</a></li><li><a href='        htod.html'>htod &ndash; .h to .d
      </a></li></ul>
    <li class='has-sub'><a href='#'><span>Books &amp; Articles</span></a>
      <ul><li><a href='        http://ddili.org/ders/d.en/index.html'>Online Book (free)</a></li><li><a href='        http://wiki.dlang.org/Books'>More Books</a></li><li><a href='        howtos.html'>How-tos</a></li><li><a href='        faq.html'>FAQ</a></li><li><a href='        const-faq.html'>const(FAQ)</a></li><li><a href='        comparison.html'>Feature Overview</a></li><li><a href='        d-floating-point.html'>Floating Point</a></li><li><a href='        wc.html'>Example: wc</a></li><li><a href='        warnings.html'>Warnings</a></li><li><a href='        rationale.html'>Rationale</a></li><li><a href='        builtin.html'>Builtin Rationale</a></li><li><a href='        ctod.html'>C to D</a></li><li><a href='        cpptod.html'>C++ to D</a></li><li><a href='        pretod.html'>C Preprocessor vs D</a></li><li><a href='        code_coverage.html'>Code coverage analysis</a></li><li><a href='        exception-safe.html'>Exception Safety</a></li><li><a href='        hijack.html'>Hijacking</a></li><li><a href='        intro-to-datetime.html'>Introduction to std.datetime</a></li><li><a href='        lazy-evaluation.html'>Lazy Evaluation</a></li><li><a href='        migrate-to-shared.html'>Migrating to Shared</a></li><li><a href='        mixin.html'>Mixins</a></li><li><a href='        regular-expression.html'>Regular Expressions</a></li><li><a href='        safed.html'>SafeD</a></li><li><a href='        templates-revisited.html'>Templates Revisited</a></li><li><a href='        tuple.html'>Tuples</a></li><li><a href='        ctarguments.html'>Compile-time Argument Lists</a></li><li><a href='        variadic-function-templates.html'>Variadic Templates</a></li><li><a href='        d-array-article.html'>D Slices
      </a></li></ul>
    <li class='has-sub'><a href='#'><span>Resources</span></a>
      <ul><li><a href='        library/index.html'>NEW Library Reference Preview</a></li><li><a href='        http://rainers.github.io/visuald/visuald/StartPage.html'>Visual D</a></li><li><a href='        http://wiki.dlang.org/Editors'>Editors</a></li><li><a href='        http://wiki.dlang.org/IDEs'>IDEs</a></li><li><a href='        dstyle.html'>The D Style</a></li><li><a href='        glossary.html'>Glossary</a></li><li><a href='        acknowledgements.html'>Acknowledgments</a></li><li><a href='        sitemap.html'>Sitemap
      </a></li></ul>
</ul></div>
</div>

<div class="hyphenate" id="content">    
<div id="tools">	<span class="tip">		<a href="https://issues.dlang.org/enter_bug.cgi?bug_file_loc=http%3A%2F%2Fdlang.org/&bug_severity=enhancement&component=dlang.org&op_sys=All&priority=P3&product=D&rep_platform=All&short_desc=%5BFloating Point%5D&version=D2" class="button">Report a bug</a>
		<span >			If you spot a problem with this page, click here to create a Bugzilla issue.
		</span>
	</span>
	<span class="tip">		<a href="https://github.com/D-Programming-Language/dlang.org/edit/master/float.dd" class="button">Improve this page</a>
		<span >			Quickly fork, edit online, and submit a pull request for this page.
			Requires a signed-in GitHub account. This works well for small changes.
			If you'd like to make larger changes you may want to consider using
			local clone.
		</span>
	</span>
</div>
    <h1>Floating Point</h1>
    
    <!--Generated by Ddoc from float.dd-->



<h3>Floating Point Intermediate Values</h3>

	<p>On many computers, greater
	precision operations do not take any longer than lesser
	precision operations, so it makes numerical sense to use
	the greatest precision available for internal temporaries.
	The philosophy is not to dumb down the language to the lowest
	common hardware denominator, but to enable the exploitation
	of the best capabilities of target hardware.
	</p>

	<p>For floating point operations and expression intermediate values,
	a greater precision can be used than the type of the
	expression.
	Only the minimum precision is set by the types of the
	operands, not the maximum. <b>Implementation Note:</b> On Intel
	x86 machines, for example,
	it is expected (but not required) that the intermediate
	calculations be done to the full 80 bits of precision
	implemented by the hardware.
	</p>

	<p>It's possible that, due to greater use of temporaries and
	common subexpressions, optimized code may produce a more
	accurate answer than unoptimized code.
	</p>

	<p>Algorithms should be written to work based on the minimum
	precision of the calculation. They should not degrade or
	fail if the actual precision is greater. Float or double types,
	as opposed to the real (extended) type, should only be used for:
	</p>

	<ul>	    <li>reducing memory consumption for large arrays</li>
	    <li>when speed is more important than accuracy</li>
	    <li>data and function argument compatibility with C</li>
	</ul>

<h3>Floating Point Constant Folding</h3>

	<p>Regardless of the type of the operands, floating point
	constant folding is done in <span class="d_inlinecode donthyphenate notranslate">real</span> or greater precision.
	It is always done following IEEE 754 rules and round-to-nearest
	is used.</p>

	<p>Floating point constants are internally represented in
	the implementation in at least <span class="d_inlinecode donthyphenate notranslate">real</span> precision, regardless
	of the constant's type. The extra precision is available for
	constant folding. Committing to the precision of the result is
	done as late as possible in the compilation process. For example:</p>

<pre class="d_code notranslate"><span class="d_keyword">const</span> <span class="d_keyword">float</span> f = 0.2f;
writeln(f - 0.2);
</pre>
	<p>will print 0. A non-const static variable's value cannot be
	propagated at compile time, so:</p>

<pre class="d_code notranslate"><span class="d_keyword">static</span> <span class="d_keyword">float</span> f = 0.2f;
writeln(f - 0.2);
</pre>
	<p>will print 2.98023e-09. Hex floating point constants can also
	be used when specific floating point bit patterns are needed that
	are unaffected by rounding. To find the hex value of 0.2f:</p>

<pre class="d_code notranslate"><span class="d_keyword">import</span> std.stdio;

<span class="d_keyword">void</span> main()
{
    writefln(<span class="d_string">"%a"</span>, 0.2f);
}
</pre>
	<p>which is 0x1.99999ap-3. Using the hex constant:</p>

<pre class="d_code notranslate"><span class="d_keyword">const</span> <span class="d_keyword">float</span> f = 0x1.99999ap-3f;
writeln(f - 0.2);
</pre>

	<p>prints 2.98023e-09.</p>

	<p>Different compiler settings, optimization settings,
	and inlining settings can affect opportunities for constant
	folding, therefore the results of floating point calculations may differ
	depending on those settings.</p>

<h3>Rounding Control</h3>

	<p>IEEE 754 floating point arithmetic includes the ability to set 4
	different rounding modes.
	These are accessible via the functions in <span class="d_inlinecode donthyphenate notranslate">core.stdc.fenv</span>.
	</p>

	<p>If the floating-point rounding mode is changed within a function,
	it must be restored before the function exits. If this rule is violated
	(for example, by the use of inline asm), the rounding mode used for
	subsequent calculations is undefined.
	</p>


<h3>Exception Flags</h3>

	<p>IEEE 754 floating point arithmetic can set several flags based on what
	happened with a
	computation:</p>

	<table>	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_INVALID</span></td></tr>
	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_DENORMAL</span></td></tr>
	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_DIVBYZERO</span></td></tr>
	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_OVERFLOW</span></td></tr>
	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_UNDERFLOW</span></td></tr>
	<tr><td><span class="d_inlinecode donthyphenate notranslate">FE_INEXACT</span></td></tr>
	</table>

	<p>These flags can be set/reset via the functions in <span class="d_inlinecode donthyphenate notranslate">core.stdc.fenv</span>.</p>

<h3><a class="anchor" title="Permalink to this section" id="floating-point-transformations" href="#floating-point-transformations">Floating Point Transformations</a></h3>

	<p>An implementation may perform transformations on
	floating point computations in order to reduce their strength,
	i.e. their runtime computation time.
	Because floating point math does not precisely follow mathematical
	rules, some transformations are not valid, even though some
	other programming languages still allow them.
	</p>

	<p>The following transformations of floating point expressions
	are not allowed because under IEEE rules they could produce
	different results.
	</p>

	<center><table><caption>Disallowed Floating Point Transformations</caption>	<tr><th class="donthyphenate"><b>transformation</b></th><th class="donthyphenate"><b>comments</b></th></tr>
	<tr><td>	<i>x</i> + 0 &rarr; <i>x</i> </td><td>not valid if <i>x</i> is -0
	</td></tr>
	<tr><td>	<i>x</i> - 0 &rarr; <i>x</i> </td><td>not valid if <i>x</i> is &plusmn;0 and rounding is towards -&infin;
	</td></tr>
	<tr><td>	-<i>x</i> &harr; 0 - <i>x</i> </td><td>not valid if <i>x</i> is +0
	</td></tr>
	<tr><td>	<i>x</i> - <i>x</i> &rarr; 0 </td><td>not valid if <i>x</i> is NaN or &plusmn;&infin;
	</td></tr>
	<tr><td>	<i>x</i> - <i>y</i> &harr; -(<i>y</i> - <i>x</i>) </td><td>not valid because (1-1=+0) whereas -(1-1)=-0
	</td></tr>
	<tr><td>	<i>x</i> * 0 &rarr; 0 </td><td>not valid if <i>x</i> is NaN or &plusmn;&infin;
	</td></tr>

	<tr><td>	<i>x</i> / <i>c</i> &harr; <i>x</i> * (1/<i>c</i>) </td><td>valid if (1/<i>c</i>) yields an e<i>x</i>act result
	</td></tr>
	<tr><td>	<i>x</i> != <i>x</i> &rarr; false </td><td>not valid if <i>x</i> is a NaN
	</td></tr>
	<tr><td>	<i>x</i> == <i>x</i> &rarr; true </td><td>not valid if <i>x</i> is a NaN
	</td></tr>
	<tr><td>	<i>x</i> !<i>op</i> <i>y</i> &harr; !(<i>x</i> <i>op</i> <i>y</i>) </td><td>not valid if <i>x</i> or <i>y</i> is a NaN
	</td></tr>
	</table></center>

	<p>Of course, transformations that would alter side effects are also
	invalid.</p>




</div>
<div id="copyright">Copyright &copy; 1999-2017 by Digital Mars &reg;, All Rights Reserved | Page generated by <a href="http://dlang.org/ddoc.html">Ddoc</a> on (no date time)</div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write('<script src="js/jquery-1.7.2.min.js">\x3C/script>');</script>
    <script type="text/javascript" src="js/dlang.js"></script>
    
    <script type="text/javascript" src="js/codemirror-compressed.js"></script>
    <script type="text/javascript" src="js/run.js"></script>

<script type="text/javascript" src="js/run-main-website.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
</body>
</html>
