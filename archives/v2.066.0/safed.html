
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">

<!--
    Copyright (c) 1999-2017 by Digital Mars
    All Rights Reserved Written by Walter Bright
    http://digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>SafeD - D Programming Language</title>
<link rel="stylesheet" href="css/codemirror.css" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="js/codemirror-compressed.js"></script>
<script src="js/run-main-website.js" type="text/javascript"></script>
<script src="js/run.js" type="text/javascript"></script>

<script type="text/javascript">
function bodyLoad()
{
    var links = document.getElementById("navigation").getElementsByTagName("a");
    for (var i = 0; i < links.length; i++)
    {
        var url = "/" + links[i].getAttribute("href");
        if (window.location.href.match(url + "\x24") == url)
        {
            var cls = links[i].getAttribute("class");
            links[i].setAttribute("class", cls ? cls + " active" : "active");
            break;
        }
    }
}
</script>
</head>

<body onLoad='bodyLoad()'>

<div id="top">
    <div id="search-box">
        <form method="get" action="http://google.com/search">
            <img src="images/search-left.gif" width="11" height="22" /><input id="q" name="q" /><input type="image" id="search-submit" name="submit" src="images/search-button.gif" />
            <input type="hidden" id="domains" name="domains" value="dlang.org" />
            <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
            <div id="search-dropdown">
                <select id="sitesearch" name="sitesearch" size="1">
                    <option value="dlang.org">Entire D Site</option>
                    <option value="dlang.org/phobos">Library Reference</option>
                    <option value="digitalmars.com/d/archives">Newsgroup Archives</option>
                </select>
            </div>
        </form>
    </div>
    <div id="header">
        <a id="d-language" href="/">
        <img id="logo" width="125" height="95" border="0" alt="D Logo" src="images/dlogo.png">
        D Programming Language</a>
    </div>
</div>

<!--Generated by Ddoc from safed.dd-->



<div id="navigation">
  

<div class="navblock">
<h2><a href="index.html" title="D Programming Language">D 2.066.0</a></h2>
<ul>    <li><a href="overview.html" title="D language overview">Overview</a></li>
    <li><a href="comparison.html" title="D feature list">Features</a></li>
    <li><a href="download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>
    <li><a href="changelog.html" title="History of changes to D">Change Log</a></li>
    <li><a href="bugstats.php" title="D issue and bug tracking system">Bug Tracker</a></li>
    <li><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>
    <li><a href="appendices.html">Appendices</a></li>
    <li><a href="acknowledgements.html" title="Thank-you to these people who have helped with D">Acknowledgments</a></li>
    <li><a href="sitemap.html" title="Documents on this site, indexed alphabetically">Sitemap</a></li>
    <li><a href="http://digitalmars.com/d/1.0/index.html" title="D Programming Language 1.0">D1 Home</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Documentation</h2>
<ul>    <li><a href="http://ddili.org/ders/d.en/index.html">Online Book (free)</a></li>
    <li><a href="http://wiki.dlang.org/Books" title="D Programming Language Books">More Books</a></li>

    <li><a href="language-reference.html">Language Reference</a></li>
    <li><a href="phobos/index.html">Library Reference</a></li>
    <li><a href="library/index.html">&nbsp;<font size=-1><span style="visibility: hidden">3</span>Preview new Layout</font></a></li>

    <li><a href="howtos.html" title="Helps for using D">How-tos</a></li>
    <li><a href="articles.html">Articles</a>

    <div class="navblock">
<ul>        <li><a href="const3.html" title="Const and Immutable">Const</a></li>
        <li><a href="d-floating-point.html" title="D Floating Point">Floating Point</a></li>
        <li><a href="exception-safe.html" title="Exception safe programming techniques">Exception Safety</a></li>
        <li><a href="hijack.html" title="Function Hijacking Mitigation">Hijacking</a></li>
        <li><a href="intro-to-datetime.html" title="Introduction to std.datetime">Introduction to std.datetime</a></li>
        <li><a href="lazy-evaluation.html" title="Lazy evaluation of function arguments">Lazy Evaluation</a></li>
        <li><a href="memory.html" title="Memory management techniques in D">Memory Management</a></li>
        <li><a href="migrate-to-shared.html" title="Migrating to Shared">Migrating to Shared</a></li>
        <li><a href="mixin.html" title="String mixins compile string literals into D programs">Mixins</a></li>
        <li><a href="regular-expression.html" title="Programming with regular expressions">Regular Expressions</a></li>
        <li><a href="safed.html" title="SafeD - The Safe Subset of D">SafeD</a></li>
        <li><a href="templates-revisited.html" title="D takes a fresh look at template design">Templates Revisited</a></li>
        <li><a href="tuple.html" title="What tuples are and how to use them">Tuples</a></li>
        <li><a href="variadic-function-templates.html" title="Variadic arguments to templates">Variadic Templates</a></li>
        <li><a href="d-array-article.html" title="D Slices">D Slices</a></li>
    </ul>
</div></li>
</ul>
    </div>

<div class="navblock">
<h2><a href="http://rainers.github.io/visuald/visuald/StartPage.html">Visual D</a></h2>
<ul></ul>
    </div>

<div class="navblock">
<h2>Community</h2>
<ul>    <li><a href="http://forum.dlang.org/" title="User forums">Forums</a></li>
    <li><a href="http://github.com/D-Programming-Language" title="D on github">GitHub</a></li>
    <li><a href="http://wiki.dlang.org" title="Wiki for the D Programming Language">Wiki</a></li>
    <li><a href="http://wiki.dlang.org/Review_Queue" title="Queue of current and upcoming standard library additions">Review Queue</a></li>
    <li><a href="http://code.dlang.org" title="Third party packages written in D">Third Party Packages</a></li>
    <li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>
    <li><a href="http://digitalmars.com/d/dlinks.html" title="External D related links">Links</a></li>
    
</ul>
    </div>
  
<div id="translate" class="tool">Translate this page:
    <div id="google_translate_element"></div><script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        autoDisplay: false,
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
    </script>
<script type="text/javascript" src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</div>
</div><!--/navigation-->
<div id="content" class='hyphenate'>
  
<div id="tools">
    <!--span id="lastupdate">Last update (no date time)</span-->
    <span class="tip">
        <a href="https://github.com/D-Programming-Language/dlang.org/edit/master/safed.dd" class="button">Improve this page</a>
        <span>
            Quickly fork, edit online, and submit a pull request for this page.
            Requires a signed-in GitHub account. This works well for small changes.
            If you'd like to make larger changes you may want to consider using
            local clone.
        </span>
    </span>
    <span class="tip">
        <a href="http://wiki.dlang.org/DocComments/SafeD" class="button">Page wiki</a>
        <span>
            View or edit the community-maintained wiki page associated with this page.
        </span>
    </span>
</div>
  <h1>SafeD</h1>
  
	<p>	<small>by Bartosz Milewski, a member of the D design team</small>
	</p>

	<p>	I've seen some very good programmers move away from C++ in favor of languages like Java or C#. Being a hard-core C++ programmer myself, I wondered why anyone would want to switch to a less powerful and less efficient language. Mind you, I could understand why a newcomer would opt for a simpler, flatter-learning-curve language but, once somebody invested the time and effort to become proficient in C++, why in the world would they want to abandon it? 
	</p>

	<p>	The universal reason I've heard from the turncoats was &ldquo;productivity.&rdquo; The consensus seems to be that programmers are more productive using Java, C#, Ruby, or Python then they are using C++. 
	</p>

	<p>	What are the major impediments to productive programming in C++? 
	</p>

	<p>	<b>Horrible syntax</b> is one. This is actually more serious than it sounds. A good programmer can probably master some pretty horrible syntaxes given enough time. The problem is that C++ syntax and grammar is not only human-unfriendly but also parser-hostile. The fact that the Java market is saturated with productivity boosting tools is the reflection of the language's parseability. I have to yet see a C++ programming environment that would offer such powerful refactoring tools as are commonplace in Java. 
	</p>

	<p>	Language safety is the other major factor. C++ is notorious for presenting a never ending gallery of opportunities to shoot yourself in the foot. In fact C++ not only provides the opportunity to write dangerous code, it <i>encourages </i> it. At some point a major C++ compiler vendor marked a portion of STL algorithms as "deprecated" because of safety concerns. In particular the C++ Standard Library, in accordance with the spirit of C++, extends the number of ways a buffer overflow bug might sneak into your program. 
	</p>

	<p>	One notorious example is the <span class="notranslate"><span class="d_inlinecode donthyphenate">std::swap_ranges</span></span> algorithm, which takes three iterators. The first two iterators are supposed to delimit one range, the third one marks the beginning of the second range. No testing is done whether the second range doesn't extend past the end of the container. When it does, virus writers rejoice!
	</p>
	
	<p>	The pipe dream of programming language designers is to be able to guarantee that if a program compiles successfully, it will work. Of course you have to be reasonable about your definition of a "working" program. For instance, you might require that the program will never get "stuck"&mdash;a term which has a precise meaning in computer science, but loosely means that the program will not GP-fault on you (it is stuck in the sense that there is no well-defined system-independent next step). Languages that have such a property are called "sound". 
	</p>

	<p>	Guess what, there is a well-defined (and meaningful) subset of Java that is sound. Real-life Java programs, for practical reasons, stray outside of this sound subset; but at least the use of unsafe features is less prevalent and easier to spot in a Java program than it is in a C++ program. In practice, a Java compiler will detect more bugs in your program than a C++ compiler, and that translates directly into less time spent debugging&mdash;ergo, higher productivity. 
	</p>

	<p>	So what are the good features of C++?
	</p>

	<p>	Performance is one. It's really hard to beat C++ performance. If your program has to be fast and responsive you have little choice but to write it in C++ (or, in rare cases, in C or assembly). 
	</p>

	<p>	Then there are the low-level features of C++ that let you write programs interacting directly with hardware. For instance, C and C++ are still kings of embedded programming.
	</p>

	<p>	C++ offers powerful abstractions, in particular the ability to write generic code. Java and C# have their own generics but they are feeble compared to what C++ has to offer. 
	</p>

	<p>	All these features make C++ an ideal language for writing operating
	systems. Operating systems are huge programs that have to be fast and
	interact directly with hardware. But even outside operating systems
	there are a lot of applications that have to be large and fast.
	</p>

	<p>	So it looks like the programming world could be nicely partitioned between C++, Java, C# and the likes. And it all makes sense as long as you believe in the unavoidability of tradeoffs. But there is no law of nature that says, <i>You have to trade productivity for power</i>.
	</p>
	
	<p>	What about a language that is built like an onion. It has a reasonably simple and safe core, which is not unlike Java or C#. A programmer can quickly master a safe subset of it and be as productive as a Java programmer (if not more). And what if the safe subset offered performance that was comparable to C++? 
	</p>
	
	<p>	And then, the same language has outer layers that can be mastered gradually, as the need arises. It offers low-level features to grind the hardware, and high-level features to generate code on demand. It offers modularity and implementation hiding. It has unrivaled compile time features that enable lightning fast runtime performance.
	</p>
	
	<p>	I'll let you in on a secret, this language is D. 
	</p>
	
	<h2>Programming Pitfalls</h2>
	
	<p>	Did you know that the famous <span class="notranslate"><span class="d_inlinecode donthyphenate">"Hello World!"</span></span> program, which is usually the first program people write in C, exposes some of the most dangerous features of the language? It contains this statement:
	</p>
	
	<pre class="ccode"><span class="notranslate">printf ("Hello World!\n");</span></pre>
	
	Consider the signature of <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span>:
	
	<pre class="ccode"><span class="notranslate">int printf (const char * restrict format, ...);	</span></pre>
	
	<p>	(<span class="notranslate"><span class="d_inlinecode donthyphenate">restrict</span></span> is a new C keyword.) First of all, it's a function that takes a variable number of arguments. The number and the types of arguments are encoded in the format string. 
	</p>
	
	<p>	When is the match between the format and the argument list checked? Not at compile time&mdash;the compiler has no understanding of the format string (although some compilers may issue warnings if the string is statically known). At runtime then? Well, guess again. Consider this: If the programmer makes a mistake of calling printf with too few arguments, he or she will not get a nice error code or exception. Here's what the C Standard says about this situation:
	</p>
	
<table border="1" cellpadding="4" cellspacing="0"><tr><td bgcolor="#ffffcc">
  	If there are insufficient arguments for the format, the behavior is undefined.
</td></tr></table>
	
	<p>	Undefined behavior is the worst thing that may happen to a program. If you're lucky, the program will fault and terminate without prejudice. If you're not so lucky, the program will continue in a compromised state and, in the worst case, it will execute malicious code that will take over your computer.
	</p>
	
	<p>	The second dangerous feature of <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span> is its use of a pointer. It is up to the diligence of the programmer to ensure that a pointer points to a valid piece of data. In the <span class="notranslate"><span class="d_inlinecode donthyphenate">"Hello World!"</span></span> example, the pointer points to a null-terminated static string, so we're fine. But the following program will compile too:
	</p>
	
	
	<pre class="ccode"><span class="notranslate">char * format = 0;
printf (format);	</span></pre>
	
	<p>	Guess what happens. Inside <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span> the pointer is dereferenced and then all bets are off. Again, citing the C Standard,
	</p>
	
<table border="1" cellpadding="4" cellspacing="0"><tr><td bgcolor="#ffffcc">
	If an invalid value has been assigned to the pointer, the behavior of the unary * operator is undefined.
</td></tr></table>
	
	<p>	Let's talk about pointers some more. Every memory allocation returns a valid pointer (unless the program runs out of memory). You might think that dereferencing such a pointer would be safe. That is correct as long as your program doesn't free the allocated memory thus ending the lifetime of the object. After that, you are dealing with a dangling pointer and all bets are off. Again, C Standard is pretty upfront about it.
	</p>
	
<table border="1" cellpadding="4" cellspacing="0"><tr><td bgcolor="#ffffcc">
	Among the invalid values for dereferencing a pointer by the unary * operator are a null pointer, an address inappropriately aligned for the type of object pointed to, and the address of an object after the end of its lifetime.
</td></tr></table>
	
	<p>	As you can see, C was not designed for the faint of heart. It's a low-level language and the programmer better know what he or she is doing or suffer the consequences. 
	</p>
	
	<p>	C++ is different though, right?
	</p>
	
	<p>	Throughout its history, C++ has been struggling with C legacy. A lot of constructs have been provided to patch the unsafe features of C. For instance, the <span class="notranslate"><span class="d_inlinecode donthyphenate">"Hello World!"</span></span> program in C++ might be transformed to a safer version.
	</p>
	
	
	<pre class="ccode"><span class="notranslate">std:cout &lt;&lt; "Hello World!" &lt;&lt; std::endl;	</span></pre>
	
	<p>	There is no variable argument count, and the <span class="notranslate"><span class="d_inlinecode donthyphenate">std::cout</span></span> object is smart enough to understand the types of arguments passed to it (still, many programmers continue using <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span> in C++, if only for its syntactic simplicity).
	</p>
	
	<p>	Unlike in C, memory allocation in C++ is typed and combined with object construction (as long as you stay away from <span class="notranslate"><span class="d_inlinecode donthyphenate">malloc</span></span> and <span class="notranslate"><span class="d_inlinecode donthyphenate">free</span></span>). That's the good part. However, objects still have to be explicitly recycled (deleted). And after recycling, the program is still left with dangling pointers, whose dereferencing&mdash;you guessed it&mdash;leads to undefined behavior. 
	</p>
	
	<p>	Whereas pointers were important in C, C++ embraced them as the main vehicle for the Standard Library. STL algorithms use iterators, objects that are either pointers themselves or imitate the behavior (and the pitfalls) of pointers. Just like with pointers, a programmer's error in using iterators leads to undefined behavior (see the <span class="notranslate"><span class="d_inlinecode donthyphenate">swap_range</span></span> example).
	</p>
	
	<p>	In response to C/C++'s inherent lack of safety, languages like Java and C# took a different path. They either ban pointers altogether or relegate them to special "unsafe" blocks. Memory management, with its risk of accessing recycled data, is taken away from the programmer and dealt with by automatic garbage collection. There are many other simplifications and safety improvements over C++. Unfortunately they all come at the expense of expressive power and performance.
	</p>

	
	
<h2>The SafeD Subset</h2>	

	<p>	In D, we expect the  vast majority of programmers to operate within the safe subset of D, which we call SafeD. The safety and the ease of use of SafeD is comparable to Java&mdash;in fact Java programs can be machine-translated  into this safe subset of D. SafeD is easy to learn and it keeps the programmers away from undefined behaviors. It is also very efficient.
	</p>
	
	<p>	When you enter SafeD, you  leave your pointers, unchecked casts and unions at the door. Memory management is provided to you courtesy of Garbage Collection. Class objects are passed around using opaque handles. Arrays and strings are bound-checked (it's possible to turn the checks off with a compiler switch, but then you're no longer in SafeD). You may still write code that will throw a runtime exception (e.g., array out-of-bounds error, or uninitialized-class-object error), but you won't be able to overwrite memory that hasn't been allocated to you or that has already been recycled. 
	</p>
	
	<p>	Let's look at the <span class="notranslate"><span class="d_inlinecode donthyphenate">"Hello World!"</span></span> program in D. On the face of it, it's not much different than its C counterpart: 
	</p>
	
<pre class="d_code"><span class="notranslate">writeln (<span class="d_string">"Hello Safe World!"</span>);
</span></pre>
	
	<p>	The function <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span> is the equivalent of the C <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span> (more precisely, it's the representative of a family of output functions including <span class="notranslate"><span class="d_inlinecode donthyphenate">write</span></span> and its formatting versions, <span class="notranslate"><span class="d_inlinecode donthyphenate">writef</span></span> and <span class="notranslate"><span class="d_inlinecode donthyphenate">writefln</span></span>). Just like <span class="notranslate"><span class="d_inlinecode donthyphenate">printf</span></span>,  <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span> accepts a variable number of arguments of arbitrary types. But here the similarity ends. As long as you pass SafeD-arguments to <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span>, you are guaranteed not to encounter any undefined behavior. Here, <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span> is called with a single argument of the type <span class="notranslate"><span class="d_inlinecode donthyphenate">string</span></span>. In contrast to C, D <span class="notranslate"><span class="d_inlinecode donthyphenate">string</span></span> is not a pointer. It is an array of <span class="notranslate"><span class="d_inlinecode donthyphenate">immutable char</span></span>, and arrays are a built into the safe subset of D. 
	</p>
	
	<p>	You might be interested to know how the safety of <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span> is accomplished in D. One possible approach would have been to make <span class="notranslate"><span class="d_inlinecode donthyphenate">writeln</span></span> a compiler intrinsic, so that correct code would be generated on a case-by-case basis. The beauty of D is that it gives a sophisticated programmer tools that allow such case-by-case code generation of code. The advanced features used in the implementation of writeln are:
	<ul>	<li>Compile-time code generation using templates, and</li>
	<li>A safe mechanism for dealing with variable number of arguments using tuples.</li>
	</ul>
	
</p>

<h2>SafeD Libraries</h2>	
	<p>	One of the major differences between Java and D is that D has enough power to let an advanced programmer implement libraries that can be used within SafeD.
	</p>
	
	<p>	A lot of advanced features of D are compatible with SafeD, as long as they don't force the user to use unsafe types. For instance, a library may provide the implementation of a generic list. The list can be instantiated with any type, in particular with a pointer type. A list of pointers, by definition, cannot be safe, because pointer arithmetic is unsound. However, a list of ints or class objects can and should be safe. That's why such ageneric lists  can be used in SafeD, even though their usage outside of SafeD may be unsafe.
	</p>
	
	<p>	Moreover, it might be more efficient to base the internal implementation of a list on pointers. As long as these pointers are not exposed to the client, such an implementation might be certified to be SafeD compatible<sup>1</sup> . You can have a cake (advanced features of D) and eat it too (take advantage of them in SafeD).
	</p>


	
<h2>One User's Experience</h2>	
	<p>	Even before I came up with the idea of SafeD<sup>2</sup>, I tried to
	restrict myself to the safe subset of D for most of my projects. I was
	surprised how much could be accomplished and how my productivity soared.
	I also showed SafeD to my co-worker, a C++ programmer, and he was able
	to learn it in a very short time. 
	</p>
	
	<p>	So far my experience has been that if a SafeD program compiles without
	errors then, in a vast majority of cases, it runs without errors, and
	does what I want it to do. That definitely hasn't been my experience
	with C++. 
	</p>
	
	<p>	What is even more surprising to me is that I was able to accomplish all
	that with almost non-existing support from tools and with a compiler
	that excels in cryptic error messages. D is still lacking a lot of
	infrastructure, but I can imagine how easy programming will be when a
	critical mass of productivity tools sprouts around it. And unlike C++, D
	is  easy to parse and its front end is open source. So there are no
	barriers to entry for tool writers.
	</p>
	
<h2>Footnotes</h2>	<p>
		<ol>			<li>There is no central authority to issue such certifications, each library provider has to establish a level of trust with its clients.  In particular, you should expect the D standard library to be SafeD certified by the compiler provider.</li>
			<li>The name, SafeD, was proposed by David B. Held.</li>
		</ol>
	</p>


<h2>Acknowledgments</h2><p>Many thanks go to the rest of the D design team for valuable feedback and corrections to this article</p>



  
<div id="google_ad">
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</div><!--/content-->



<div id="footernav">
<a href="http://forum.dlang.org/" title="User Forums">Forums</a> |
<a href="http://wiki.dlang.org/DocComments/SafeD" title="Read/write comments and feedback">Comments</a> |
<a href="http://digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a> |
<a href="download.html" title="Download D">Downloads</a> |
<a href="/">Home</a>
</div>
<div id="copyright">

Copyright &copy; 1999-2017 by Digital Mars &reg;, All Rights Reserved |
Page generated by <a href="ddoc.html">Ddoc</a> on (no date time)
</div>
</body>
</html>
