
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">

<!--
    Copyright (c) 1999-2017 by Digital Mars
    All Rights Reserved Written by Walter Bright
    http://digitalmars.com
  -->

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="D programming language" />
<meta name="description" content="D Programming Language" />
<title>Contract Programming - D Programming Language</title>
<link rel="stylesheet" href="css/codemirror.css" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
<link rel="shortcut icon" href="favicon.ico" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="js/codemirror-compressed.js"></script>
<script src="js/run-main-website.js" type="text/javascript"></script>
<script src="js/run.js" type="text/javascript"></script>

<script type="text/javascript">
function bodyLoad()
{
    var links = document.getElementById("navigation").getElementsByTagName("a");
    for (var i = 0; i < links.length; i++)
    {
        var url = "/" + links[i].getAttribute("href");
        if (window.location.href.match(url + "\x24") == url)
        {
            var cls = links[i].getAttribute("class");
            links[i].setAttribute("class", cls ? cls + " active" : "active");
            break;
        }
    }
}
</script>
</head>

<body onLoad='bodyLoad()'>

<div id="top">
    <div id="search-box">
        <form method="get" action="http://google.com/search">
            <img src="images/search-left.gif" width="11" height="22" /><input id="q" name="q" /><input type="image" id="search-submit" name="submit" src="images/search-button.gif" />
            <input type="hidden" id="domains" name="domains" value="dlang.org" />
            <input type="hidden" id="sourceid" name="sourceid" value="google-search" />
            <div id="search-dropdown">
                <select id="sitesearch" name="sitesearch" size="1">
                    <option value="dlang.org">Entire D Site</option>
                    <option value="dlang.org/phobos">Library Reference</option>
                    <option value="digitalmars.com/d/archives">Newsgroup Archives</option>
                </select>
            </div>
        </form>
    </div>
    <div id="header">
        <a id="d-language" href="/">
        <img id="logo" width="125" height="95" border="0" alt="D Logo" src="images/dlogo.png">
        D Programming Language</a>
    </div>
</div>

<!--Generated by Ddoc from contracts.dd-->



<div id="navigation">
  

<div class="navblock">
<h2><a href="index.html" title="D Programming Language">D 2.066.0</a></h2>
<ul>    <li><a href="overview.html" title="D language overview">Overview</a></li>
    <li><a href="comparison.html" title="D feature list">Features</a></li>
    <li><a href="download.html" title="Download a D compiler">Downloads &amp; Tools</a></li>
    <li><a href="changelog.html" title="History of changes to D">Change Log</a></li>
    <li><a href="bugstats.php" title="D issue and bug tracking system">Bug Tracker</a></li>
    <li><a href="faq.html" title="Frequently Asked Questions">FAQ</a></li>
    <li><a href="appendices.html">Appendices</a></li>
    <li><a href="acknowledgements.html" title="Thank-you to these people who have helped with D">Acknowledgments</a></li>
    <li><a href="sitemap.html" title="Documents on this site, indexed alphabetically">Sitemap</a></li>
    <li><a href="http://digitalmars.com/d/1.0/index.html" title="D Programming Language 1.0">D1 Home</a></li>
</ul>
    </div>

<div class="navblock">
<h2>Documentation</h2>
<ul>    <li><a href="http://ddili.org/ders/d.en/index.html">Online Book (free)</a></li>
    <li><a href="http://wiki.dlang.org/Books" title="D Programming Language Books">More Books</a></li>

    <li><a href="language-reference.html">Language Reference</a>

    <div class="navblock">
<ul>    <li><a href="intro.html">Introduction</a></li>
    <li><a href="lex.html">Lexical</a></li>
    <li><a href="grammar.html">Grammar</a></li>
    <li><a href="module.html">Modules</a></li>
    <li><a href="declaration.html">Declarations</a></li>
    <li><a href="type.html">Types</a></li>
    <li><a href="property.html">Properties</a></li>
    <li><a href="attribute.html">Attributes</a></li>
    <li><a href="pragma.html">Pragmas</a></li>
    <li><a href="expression.html">Expressions</a></li>
    <li><a href="statement.html">Statements</a></li>
    <li><a href="arrays.html">Arrays</a></li>
    <li><a href="hash-map.html">Associative Arrays</a></li>
    <li><a href="struct.html">Structs &amp; Unions</a></li>
    <li><a href="class.html">Classes</a></li>
    <li><a href="interface.html">Interfaces</a></li>
    <li><a href="enum.html">Enums</a></li>
    <li><a href="const3.html">Const and Immutable</a></li>
    <li><a href="function.html">Functions</a></li>
    <li><a href="operatoroverloading.html">Operator Overloading</a></li>
    <li><a href="template.html">Templates</a></li>
    <li><a href="template-mixin.html">Template Mixins</a></li>
    <li><a href="contracts.html">Contracts</a></li>
    <li><a href="version.html">Conditional Compilation</a></li>
    <li><a href="traits.html">Traits</a></li>
    <li><a href="errors.html">Handling errors</a></li>
    <li><a href="unittest.html">Unit Tests</a></li>
    <li><a href="garbage.html">Garbage Collection</a></li>
    <li><a href="float.html">Floating Point</a></li>
    <li><a href="iasm.html">Inline Assembler</a></li>
    <li><a href="ddoc.html">Documentation Comments</a></li>
    <li><a href="interfaceToC.html">Interfacing To C</a></li>
    <li><a href="cpp_interface.html">Interfacing To C++</a></li>
    <li><a href="portability.html">Portability Guide</a></li>
    <li><a href="entity.html">Named Character Entities</a></li>
    <li><a href="memory-safe-d.html">Memory Safe D Spec</a></li>
    <li><a href="abi.html">Application Binary Interface</a></li>
    <li><a href="simd.html">Vector Extensions</a></li>
    </ul>
</div></li>
    <li><a href="phobos/index.html">Library Reference</a></li>
    <li><a href="library/index.html">&nbsp;<font size=-1><span style="visibility: hidden">3</span>Preview new Layout</font></a></li>

    <li><a href="howtos.html" title="Helps for using D">How-tos</a></li>
    <li><a href="articles.html">Articles</a></li>
</ul>
    </div>

<div class="navblock">
<h2><a href="http://rainers.github.io/visuald/visuald/StartPage.html">Visual D</a></h2>
<ul></ul>
    </div>

<div class="navblock">
<h2>Community</h2>
<ul>    <li><a href="http://forum.dlang.org/" title="User forums">Forums</a></li>
    <li><a href="http://github.com/D-Programming-Language" title="D on github">GitHub</a></li>
    <li><a href="http://wiki.dlang.org" title="Wiki for the D Programming Language">Wiki</a></li>
    <li><a href="http://wiki.dlang.org/Review_Queue" title="Queue of current and upcoming standard library additions">Review Queue</a></li>
    <li><a href="http://code.dlang.org" title="Third party packages written in D">Third Party Packages</a></li>
    <li><a href="http://twitter.com/#search?q=%23d_lang" title="#d_lang on twitter.com">Twitter</a></li>
    <li><a href="http://digitalmars.com/d/dlinks.html" title="External D related links">Links</a></li>
    
</ul>
    </div>
  
<div id="translate" class="tool">Translate this page:
    <div id="google_translate_element"></div><script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        autoDisplay: false,
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
    </script>
<script type="text/javascript" src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</div>
</div><!--/navigation-->
<div id="content" class='hyphenate'>
  
<div id="tools">
    <!--span id="lastupdate">Last update (no date time)</span-->
    <span class="tip">
        <a href="https://github.com/D-Programming-Language/dlang.org/edit/master/contracts.dd" class="button">Improve this page</a>
        <span>
            Quickly fork, edit online, and submit a pull request for this page.
            Requires a signed-in GitHub account. This works well for small changes.
            If you'd like to make larger changes you may want to consider using
            local clone.
        </span>
    </span>
    <span class="tip">
        <a href="http://wiki.dlang.org/DocComments/DBC" class="button">Page wiki</a>
        <span>
            View or edit the community-maintained wiki page associated with this page.
        </span>
    </span>
</div>
  <h1>Contract Programming</h1>
  
	<p>Contracts are a breakthrough technique to reduce the programming effort
	for large projects. Contracts are the concept of preconditions, postconditions,
	errors, and invariants.
	Contracts can be done in C++ without modification to the language,
	but the result is
	clumsy and inconsistent.</p>

	<p>Building contract support into the language makes for:</p>

	<ol>	<li>a consistent look and feel for the contracts</li>
	<li>tool support</li>
	<li>it's possible the compiler can generate better code using information gathered
	from the contracts</li>
	<li>easier management and enforcement of contracts</li>
	<li>handling of contract inheritance</li>
	</ol>



	<p>The idea of a contract is simple - it's just an expression that must evaluate to true.
	If it does not, the contract is broken, and by definition, the program has a bug in it.
	Contracts form part of the specification for a program, moving it from the documentation
	to the code itself. And as every programmer knows, documentation tends to be incomplete,
	out of date, wrong, or non-existent. Moving the contracts into the code makes them
	verifiable against the program.</p>

<h2>Assert Contract</h2>

	The most basic contract is the
	<a href="expression.html#AssertExpression"><i>AssertExpression</i></a>.
	An <b>assert</b> inserts a checkable expression into
	the code, and that expression must evaluate to true:
<pre class="d_code"><span class="notranslate"><span class="d_keyword">assert</span>(expression);
</span></pre>
	C programmers will find it familiar. Unlike C, however, an <code>assert</code>
	in function bodies
	works by throwing an <code>AssertError</code>,
	which can be caught and handled. Catching the contract violation is useful
	when the code must deal with errant uses by other code, when it must be
	failure proof, and as a useful tool for debugging.

    <p>When compiling for release, the assert code is not generated.
        The special <span class="notranslate"><span class="d_inlinecode donthyphenate">assert(0)</span></span> expression, however, is generated even in
        release mode. See the <a href="expression.html#AssertExpression"><i>AssertExpression</i></a> documentation
        for more information.</p>

<h2>Pre and Post Contracts</h2>

	The pre contracts specify the preconditions before a statement is executed. The most
	typical use of this would be in validating the parameters to a function. The post
	contracts validate the result of the statement. The most typical use of this
	would be in validating the return value of a function and of any side effects it has.
	The syntax is:

<pre class="d_code"><span class="notranslate"><span class="d_keyword">in</span>
{
  ...contract preconditions...
}
<span class="d_keyword">out</span> (result)
{
  ...contract postconditions...
}
<span class="d_keyword">body</span>
{
  ...code...
}
</span></pre>
	<p>By definition, if a pre contract fails, then the body received bad
	parameters.
	An AssertError is thrown. If a post contract fails,
	then there is a bug in the body. An AssertError is thrown.</p>

	<p>Either the <code>in</code> or the <code>out</code> clause can be omitted.
	If the <code>out</code> clause is for a function
	body, the variable <code>result</code> is declared and assigned the return
	value of the function. For example, let's implement a square root function:</p>
<pre class="d_code"><span class="notranslate"><span class="d_keyword">long</span> square_root(<span class="d_keyword">long</span> x)
  <span class="d_keyword">in</span>
  {
    <span class="d_keyword">assert</span>(x &gt;= 0);
  }
  <span class="d_keyword">out</span> (result)
  {
    <span class="d_keyword">assert</span>((result * result) &lt;= x &amp;&amp; (result+1) * (result+1) &gt; x);
  }
  <span class="d_keyword">body</span>
  {
    <span class="d_keyword">return</span> <span class="d_keyword">cast</span>(<span class="d_keyword">long</span>)std.math.sqrt(<span class="d_keyword">cast</span>(<span class="d_keyword">real</span>)x);
  }
</span></pre>
	<p>The assert's in the in and out bodies are called <dfn>contracts</dfn>.
	Any other D
	statement or expression is allowed in the bodies, but it is important
	to ensure that the
	code has no side effects, and that the release version of the code
	will not depend on any 	effects of the code.
	For a release build of the code, the in and out code is not
	inserted.</p>

	<p>If the function returns a void, there is no result, and so there can be no
	result declaration in the out clause.
	In that case, use:</p>
<pre class="d_code"><span class="notranslate"><span class="d_keyword">void</span> func()
  <span class="d_keyword">out</span>
  {
    ...contracts...
  }
  <span class="d_keyword">body</span>
  {
    ...
  }
</span></pre>
	In an out statement, <i>result</i> is initialized and set to the
	return value of the function.

<h2>In, Out and Inheritance</h2>

	<p>If a function in a derived class overrides a function in its
	super class, then only one of
	the <span class="notranslate"><span class="d_inlinecode donthyphenate">in</span></span> contracts of the function and its base functions
	must be satisfied.
	Overriding
	functions then becomes a process of <i>loosening</i> the <span class="notranslate"><span class="d_inlinecode donthyphenate">in</span></span>
	contracts.
	</p>

	<p>A function without an <span class="notranslate"><span class="d_inlinecode donthyphenate">in</span></span> contract means that any values
	of the function parameters are allowed. This implies that if any
	function in an inheritance hierarchy has no <span class="notranslate"><span class="d_inlinecode donthyphenate">in</span></span> contract,
	then <span class="notranslate"><span class="d_inlinecode donthyphenate">in</span></span> contracts on functions overriding it have no useful
	effect.
	</p>

	<p>Conversely, all of the <span class="notranslate"><span class="d_inlinecode donthyphenate">out</span></span> contracts needs to be satisfied,
	so overriding functions becomes a processes of <i>tightening</i> the
	<span class="notranslate"><span class="d_inlinecode donthyphenate">out</span></span>
	contracts.
	</p>

<h2>Invariants</h2>

	<p>Invariants are used to specify characteristics of a class or struct that
	always must be true (except while executing a member function).
	For example, a class representing a date might have an invariant that the
	day must be 1..31 and the hour must be 0..23:
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">class</span> Date
{
  <span class="d_keyword">int</span> day;
  <span class="d_keyword">int</span> hour;

  <span class="d_keyword">invariant</span>() {
    <span class="d_keyword">assert</span>(1 &lt;= day &amp;&amp; day &lt;= 31);
    <span class="d_keyword">assert</span>(0 &lt;= hour &amp;&amp; hour &lt; 24);
  }
}
</span></pre>

	<p>The invariant is a contract saying that the asserts must hold true.
	The invariant is checked when a class or struct constructor completes,
	at the start of the class or struct destructor. For public or exported
	functions, the order of execution is:
	</p>

	<ol>	<li>preconditions</li>
	<li>invariant</li>
	<li>body</li>
	<li>invariant</li>
	<li>postconditions</li>
	</ol>

	<p>The code in the invariant may not call any public non-static members
	of the class or struct, either directly or indirectly.
	Doing so will result in a stack overflow, as the invariant will wind
	up being called in an infinitely recursive manner.
	</p>

	<p>Invariants are implicitly const.</p>

	<p>Since the invariant is called at the start of public or
	exported members, such members should not be called from
	constructors.
	</p>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">class</span> Foo {
  <span class="d_keyword">public</span> <span class="d_keyword">void</span> f() { }
  <span class="d_keyword">private</span> <span class="d_keyword">void</span> g() { }

  <span class="d_keyword">invariant</span>() {
    f();  <span class="d_comment">// error, cannot call public member function from invariant
</span>    g();  <span class="d_comment">// ok, g() is not public
</span>  }
}
</span></pre>

	The invariant can be checked with an <code>assert()</code> expression:

	<ol>	<li>classes need to pass a class object</li>
	<li>structs need to pass the address of an instance</li>
	</ol>

<pre class="d_code"><span class="notranslate"><span class="d_keyword">auto</span> mydate = <span class="d_keyword">new</span> Date(); <span class="d_comment">//class
</span><span class="d_keyword">auto</span> s = S();             <span class="d_comment">//struct
</span>...
<span class="d_keyword">assert</span>(mydate);           <span class="d_comment">// check that class Date invariant holds
</span><span class="d_keyword">assert</span>(&amp;s);               <span class="d_comment">// check that struct S invariant holds
</span></span></pre>

	<p>Invariants contain assert expressions, and so when they fail,
	they throw a <span class="notranslate"><span class="d_inlinecode donthyphenate">AssertError</span></span>s.
	Class invariants are inherited, that is,
	any class invariant is implicitly anded with the invariants of its base
	classes.</p>

	<p>There can be only one <i>Invariant</i> per class or struct.</p>

	<p>When compiling for release, the invariant code is not generated, and the compiled program runs at maximum speed.</p>

<h2>References</h2>

	<ul><li>	<a href="http://people.cs.uchicago.edu/~robby/contract-reading-list/">Contracts Reading List</a></li><li>	<a href="http://jan.newmarch.name/java/contracts/paper-long.html">Adding Contracts to Java</a>
	</li></ul>


  
<div id="google_ad">
<!-- Google ad -->
<script type="text/javascript"><!--
/**/google_ad_client = "pub-5628673096434613";
/**/google_ad_width = 728;
/**/google_ad_height = 90;
/**/google_ad_format = "728x90_as";
/**/google_ad_channel ="3651639259";
/**/google_page_url = document.location;
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</div><!--/content-->



<div id="footernav">
<a href="http://forum.dlang.org/" title="User Forums">Forums</a> |
<a href="http://wiki.dlang.org/DocComments/DBC" title="Read/write comments and feedback">Comments</a> |
<a href="http://digitalmars.com/advancedsearch.html" title="Search Digital Mars web site">Search</a> |
<a href="download.html" title="Download D">Downloads</a> |
<a href="/">Home</a>
</div>
<div id="copyright">

Copyright &copy; 1999-2017 by Digital Mars &reg;, All Rights Reserved |
Page generated by <a href="ddoc.html">Ddoc</a> on (no date time)
</div>
</body>
</html>
