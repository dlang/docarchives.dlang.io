
<!DOCTYPE html>
<html lang="en-US">
<!--
    Copyright (c) 1999-2024 by the D Language Foundation
    All Rights Reserved.
    https://dlang.org/foundation_overview.html
  -->
<head>
<meta charset="utf-8">
<meta name="keywords" content="D programming language">
<meta name="description" content="D Programming Language">
<title>Live Functions - D Programming Language</title>

<link rel="stylesheet" href="../css/codemirror.css">
<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/print.css" media="print">
<link rel="shortcut icon" href="../favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=10.0">

</head>
<body id='Live Functions' class='doc'>
<script type="text/javascript">document.body.className += ' have-javascript'</script>
<div id="top"><div class="helper"><div class="helper expand-container">    <div class="logo"><a href=".."><img id="logo" alt="D Logo" src="../images/dlogo.svg"></a></div>
    <a href="../menu.html" title="Menu" class="hamburger expand-toggle"><span>Menu</span></a>
    
<div id="cssmenu"><ul>    <li><a href='https://tour.dlang.org'><span>Learn</span></a></li>
    <li class='expand-container'><a class='expand-toggle' href='../documentation.html'><span>Documentation</span></a>
      
<ul class='expand-content'>    <li><a href='../spec/spec.html'>Language Reference</a></li>
    <li><a href='../phobos/index.html'>Library Reference</a></li>
    <li><a href='../dmd.html'>Command-line Reference</a></li>
    <li class="menu-divider"><a href='../comparison.html'>Feature Overview</a></li>
    <li><a href='../articles.html'>Articles</a></li>
 </ul></li>
    <li><a href='../download.html'><span>Downloads</span></a></li>
    <li><a href='https://code.dlang.org'><span>Packages</span></a></li>
    <li class='expand-container'><a class='expand-toggle' href='../community.html'><span>Community</span></a>
      
<ul class='expand-content'>    <li><a href='https://dlang.org/blog'>Blog</a></li>
    <li><a href='../orgs-using-d.html'>Orgs using D</a></li>
    <li><a href='https://twitter.com/search?q=%23dlang'>Twitter</a></li>
    <li class="menu-divider"><a href='https://forum.dlang.org'>Forums</a></li>
    <li><a href='irc://irc.libera.chat/d'>IRC</a></li>
    <li><a href='https://discord.gg/bMZk9Q4'>Community Discord</a></li>
    <li><a href='https://wiki.dlang.org'>Wiki</a></li>
    <li class="menu-divider"><a href='../bugstats.html'>Issues</a></li>
    <li><a href='../contributing.html'>Contributing</a></li>
    <li class="menu-divider"><a href='../foundation/contributors.html'>Contributors</a></li>
    <li><a href='../foundation/index.html'>Foundation</a></li>
    <li><a href='..//security.html'>Security Team</a></li>
    <li><a href='../foundation/donate.html'>Donate</a></li>
    <li><a href='../foundation/sponsors.html'>Sponsors</a></li>
 </ul></li>
    <li class='expand-container'><a class='expand-toggle' href='../resources.html'><span>Resources</span></a>
      
<ul class='expand-content'>    <li><a href='https://tour.dlang.org'>Tour</a></li>
    <li><a href='https://wiki.dlang.org/Books'>Books</a></li>
    <li><a href='https://wiki.dlang.org/Tutorials'>Tutorials</a></li>
    <li class="menu-divider"><a href='https://wiki.dlang.org/Development_tools'>Tools</a></li>
    <li><a href='https://wiki.dlang.org/Editors'>Editors</a></li>
    <li><a href='https://wiki.dlang.org/IDEs'>IDEs</a></li>
    <li><a href='https://run.dlang.io'>run.dlang.io</a></li>
    <li><a href='http://rainers.github.io/visuald/visuald/StartPage.html'>Visual D</a></li>
    <li class="menu-divider"><a href='../acknowledgements.html'>Acknowledgments</a></li>
    <li><a href='../dstyle.html'>D Style</a></li>
    <li><a href='../spec/glossary.html'>Glossary</a></li>
    <li><a href='../sitemap.html'>Sitemap</a></li>
 </ul></li>
</ul></div>
    <div class="search-container expand-container">        <a href="../search.html" class="expand-toggle" title="Search"><span>Search</span></a>
        
    <div id="search-box">        <form method="get" action="https://google.com/search">
            <input type="hidden" id="domains" name="domains" value="dlang.org">
            <input type="hidden" id="sourceid" name="sourceid" value="google-search">
            <span id="search-query"><input id="q" name="q" placeholder="Google Search"></span><span id="search-dropdown"><span class="helper">                <select id="sitesearch" name="sitesearch" size="1">
                    <option value="dlang.org">Entire Site</option>
                    <option selected value="dlang.org/spec">Language</option>
                    <option  value="dlang.org/phobos">Library</option>
                    <option  value="forum.dlang.org">Forums</option>
                    
                </select>
            </span></span><span id="search-submit"><button type="submit"><i class="fa fa-search"></i><span>go</span></button></span>
        </form>
    </div>
    </div>
</div></div></div>

<div class="container">    
<div class="subnav-helper"></div> <div class="subnav">    <div class="head"><h2>Language Reference</h2> <p class="subnav-duplicate"><a href="../spec/spec.html">table of contents</a></p></div>
    <ul>        <li><a href='            ../spec/intro.html'>Introduction</a></li><li><a href='            ../spec/lex.html'>Lexical</a></li><li><a href='            ../spec/istring.html'>Interpolation Expression Sequence</a></li><li><a href='            ../spec/grammar.html'>Grammar</a></li><li><a href='            ../spec/module.html'>Modules</a></li><li><a href='            ../spec/declaration.html'>Declarations</a></li><li><a href='            ../spec/type.html'>Types</a></li><li><a href='            ../spec/property.html'>Properties</a></li><li><a href='            ../spec/attribute.html'>Attributes</a></li><li><a href='            ../spec/pragma.html'>Pragmas</a></li><li><a href='            ../spec/expression.html'>Expressions</a></li><li><a href='            ../spec/statement.html'>Statements</a></li><li><a href='            ../spec/arrays.html'>Arrays</a></li><li><a href='            ../spec/hash-map.html'>Associative Arrays</a></li><li><a href='            ../spec/struct.html'>Structs and Unions</a></li><li><a href='            ../spec/class.html'>Classes</a></li><li><a href='            ../spec/interface.html'>Interfaces</a></li><li><a href='            ../spec/enum.html'>Enums</a></li><li><a href='            ../spec/const3.html'>Type Qualifiers</a></li><li><a href='            ../spec/function.html'>Functions</a></li><li><a href='            ../spec/operatoroverloading.html'>Operator Overloading</a></li><li><a href='            ../spec/template.html'>Templates</a></li><li><a href='            ../spec/template-mixin.html'>Template Mixins</a></li><li><a href='            ../spec/contracts.html'>Contract Programming</a></li><li><a href='            ../spec/version.html'>Conditional Compilation</a></li><li><a href='            ../spec/traits.html'>Traits</a></li><li><a href='            ../spec/errors.html'>Error Handling</a></li><li><a href='            ../spec/unittest.html'>Unit Tests</a></li><li><a href='            ../spec/garbage.html'>Garbage Collection</a></li><li><a href='            ../spec/float.html'>Floating Point</a></li><li><a href='            ../spec/iasm.html'>D x86 Inline Assembler</a></li><li><a href='            ../spec/ddoc.html'>Embedded Documentation</a></li><li><a href='            ../spec/interfaceToC.html'>Interfacing to C</a></li><li><a href='            ../spec/cpp_interface.html'>Interfacing to C++</a></li><li><a href='            ../spec/objc_interface.html'>Interfacing to Objective-C</a></li><li><a href='            ../spec/portability.html'>Portability Guide</a></li><li><a href='            ../spec/entity.html'>Named Character Entities</a></li><li><a href='            ../spec/memory-safe-d.html'>Memory Safety</a></li><li><a href='            ../spec/abi.html'>Application Binary Interface</a></li><li><a href='            ../spec/simd.html'>Vector Extensions</a></li><li><a href='            ../spec/betterc.html'>Better C</a></li><li><a href='            ../spec/importc.html'>ImportC</a></li><li><a href='            ../spec/ob.html'>Live Functions</a></li><li><a href='            ../spec/windows.html'>Windows Programming</a></li><li><a href='            ../spec/glossary.html'>Glossary</a></li><li><a href='            ../spec/legacy.html'>Legacy Code
        </a></li>
    </ul>
</div>
    <div class="hyphenate" id="content">        
<div id="tools"><div >	<div class="tip smallprint">		<a href="https://issues.dlang.org/enter_bug.cgi?bug_file_loc=http%3A%2F%2Fdlang.org/&amp;component=dlang.org&amp;op_sys=All&amp;priority=P3&amp;product=D&amp;rep_platform=All&amp;short_desc=%5BLive Functions%5D&amp;version=D2&amp;bug_severity=enhancement">Report a bug</a>
		<div >			If you spot a problem with this page, click here to create a Bugzilla issue.
		</div>
	</div>
	<div class="tip smallprint">		<a href="https://github.com/dlang/dlang.org/edit/master/spec/ob.dd">Improve this page</a>
		<div >			Quickly fork, edit online, and submit a pull request for this page.
			Requires a signed-in GitHub account. This works well for small changes.
			If you'd like to make larger changes you may want to consider using
			a local clone.
		</div>
	</div>
</div></div>
        <h1>Live Functions</h1>
        
<style>    body { counter-reset: h1 43; counter-increment: h1 -1; }
    h1 { counter-reset: h2 h3 p; }
    h2 { counter-reset: h3 h4 p; }
    h3 { counter-reset: h4 p; }
    h4 { counter-reset: p; }
    h1::before {
        counter-increment: h1;
        content: counter(h1) ". ";
    }
    .hyphenate h2::before {
        counter-increment: h2;
        content: counter(h1) "." counter(h2) " ";
    }
    h3::before {
        counter-increment: h3;
        content: counter(h1) "." counter(h2) "." counter(h3) " ";
    }
    h4::before {
        counter-increment: h4;
        content: counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) " ";
    }
    p::before, .spec-boxes::before {
        counter-increment: p;
        content: counter(p) ". ";
    }
    h1::before, h2::before, h3::before, h4::before, p::before, .spec-boxes::before
    {
        color: #999;
        font-size: 80%;
        margin-right: 0.25em;
    }
</style>
        <div class="blankline"></div>
<div class="blankline"></div>
<div class="blankline"></div>
<div class="page-contents quickindex">    <div class="page-contents-header">        <b>Contents</b>
    </div>
    <ol>    <li><a href="#ownership">Ownership</a></li>
    <li><a href="#ob">Borrowing</a></li>
    <li><a href="#live"><span class="d_inlinecode donthyphenate notranslate">@live</span> attribute</a><ol>        <li><a href="#tracked">Tracked Pointers</a></li>
        <li><a href="#state">Pointer States</a></li>
        <li><a href="#lifetime">Lifetimes</a></li>
        <li><a href="#transition">Pointer State Transitions</a></li>
        <li><a href="#borrower">Borrowers can be Owners</a></li>
        <li><a href="#exception">Exceptions</a></li>
        <li><a href="#lazy">Lazy Parameters</a></li>
        <li><a href="#mempool">Mixing Memory Pools</a></li>
        <li><a href="#vargs">Variadic Function Arguments</a></li>
    </ol></li>
    <li><a href="#references">References</a></li>
</ol>
</div>
<div class="blankline"></div>
<b>Experimental, Subject to Change, use <span class="d_inlinecode donthyphenate notranslate">-preview=dip1021</span> to activate</b>
<div class="blankline"></div>
<h2><a class="anchor" title="Permalink to this section" id="ownership" href="#ownership">Ownership</a></h2>
<div class="blankline"></div>
<p>If a memory object has only one pointer to it, that pointer is the <i>owner</i>
of the memory object. With the single owner, it becomes straightforward to
manage the memory for the object. It also becomes trivial to synchronize access
to that memory object among multiple threads, because it can only be accessed
by the thread that controls that single pointer.
</p>
<div class="blankline"></div>
<p>This can be generalized to a graph of memory objects interconnected by pointers,
where only a single pointer connects to that graph from elsewhere. That single
pointer becomes the <i>owner</i> of all the memory objects in that graph.
</p>
<div class="blankline"></div>
<p>When the owner of the graph is no longer needed, then the graph of memory
objects it points to is no longer needed and can be safely disposed of. If the owner
itself is no longer in use (i.e. is no longer <i>live</i>) and the owned memory
objects are not disposed of, an error can be diagnosed.
</p>
<div class="blankline"></div>
<p>Hence, the following errors can be statically detected:
</p>
<div class="blankline"></div>
<pre class="d_code notranslate"><span class="d_keyword">int</span>* allocate();    <span class="d_comment">// allocate a memory object
</span><span class="d_keyword">void</span> release(<span class="d_keyword">int</span>*); <span class="d_comment">// deallocate a memory object
</span>
@live <span class="d_keyword">void</span> test()
{
    <span class="d_keyword">auto</span> p = allocate();
}   <span class="d_comment">// error: p is not disposed of
</span>
@live <span class="d_keyword">void</span> test()
{
    <span class="d_keyword">auto</span> p = allocate();
    release(p);
    release(p); <span class="d_comment">// error: p was already disposed of
</span>}

@live <span class="d_keyword">void</span> test()
{
    <span class="d_keyword">int</span>* p = <span class="d_keyword">void</span>;
    release(p); <span class="d_comment">// error, p does not have a defined value
</span>}

@live <span class="d_keyword">void</span> test()
{
    <span class="d_keyword">auto</span> p = allocate();
    p = allocate(); <span class="d_comment">// error: p was not disposed of
</span>    release(p);
}
</pre>
<div class="blankline"></div>
<p>Functions with the <span class="d_inlinecode donthyphenate notranslate">@live</span> attribute enable diagnosing these sorts of errors by
tracking the status of owner pointers.
</p>
<div class="blankline"></div>
<div class="blankline"></div>
<h2><a class="anchor" title="Permalink to this section" id="ob" href="#ob">Borrowing</a></h2>
<div class="blankline"></div>
<p>Tracking the ownership status of a pointer can be safely extended by adding the
capability of temporarilly <i>borrowing</i> ownership of a pointer from the <i>owner</i>.
The <i>owner</i> can no longer use the pointer as long as the <i>borrower</i> is still
using the pointer value (i.e. it is <i>live</i>). Once the <i>borrower</i> is no longer
<i>live</i>, the <i>owner</i> can resume using it. Only one <i>borrower</i> can be live
at any point.
</p>
<div class="blankline"></div>
<p>Multiple <i>borrower</i> pointers can simultaneously exist if all of them are
pointers to read only (<span class="d_inlinecode donthyphenate notranslate">const</span> or <span class="d_inlinecode donthyphenate notranslate">immutable</span>) data, i.e. none of them can modify the memory
object(s) pointed to.
</p>
<div class="blankline"></div>
<p>This is collectively called an <i>Ownership/Borrowing</i> system. It can be stated as:
</p>
<div class="blankline"></div>
<blockquote><p>At any point in the program, for each memory object,
there is exactly one live mutable pointer to it or all the live pointers to
it are read-only.</p></blockquote>
<div class="blankline"></div>
<div class="blankline"></div>
<h2><a class="anchor" title="Permalink to this section" id="live" href="#live"><span class="d_inlinecode donthyphenate notranslate">@live</span> attribute</a></h2>
<div class="blankline"></div>
<p>Function declarations annotated with the <span class="d_inlinecode donthyphenate notranslate">@live</span> attribute are checked for compliance with
the Ownership/Borrowing rules. The checks are run after other semantic processing is complete.
The checking does not influence code generation.
</p>
<div class="blankline"></div>
<p>Whether a pointer is allocated memory using the GC or some other
storage allocator is immaterial to OB, they are not distinguished and are
handled identically.
</p>
<div class="blankline"></div>
<p>Class references are assumed to be allocated using either the GC or are allocated
on the stack as <span class="d_inlinecode donthyphenate notranslate">scope</span> classes, and are not tracked.
</p>
<div class="blankline"></div>
<p>If <span class="d_inlinecode donthyphenate notranslate">@live</span> functions
call non-<span class="d_inlinecode donthyphenate notranslate">@live</span> functions, those called functions are expected to present
an <span class="d_inlinecode donthyphenate notranslate">@live</span> compatible interface, although it is not checked.
if non-<span class="d_inlinecode donthyphenate notranslate">@live</span> functions call <span class="d_inlinecode donthyphenate notranslate">@live</span> functions, arguments passed are
expected to follow <span class="d_inlinecode donthyphenate notranslate">@live</span> conventions.
</p>
<div class="blankline"></div>
<p>It will not detect attempts to dereference <span class="d_inlinecode donthyphenate notranslate">null</span> pointers or possibly
<span class="d_inlinecode donthyphenate notranslate">null</span> pointers. This is unworkable because there is no current method
of annotating a type as a non-<span class="d_inlinecode donthyphenate notranslate">null</span> pointer.
</p>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="tracked" href="#tracked">Tracked Pointers</a></h3>
<div class="blankline"></div>
<p>The only pointers that are tracked are those declared in the <span class="d_inlinecode donthyphenate notranslate">@live</span> function
as <span class="d_inlinecode donthyphenate notranslate">this</span>, function parameters or local variables. Variables from other
functions are not tracked, even <span class="d_inlinecode donthyphenate notranslate">@live</span> ones, as the analysis of interactions
with other functions depends
entirely on that function signature, not its internals.
Parameters that are <span class="d_inlinecode donthyphenate notranslate">const</span> are not tracked.
</p>
<div class="blankline"></div>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="state" href="#state">Pointer States</a></h3>
<div class="blankline"></div>
<p>Each tracked pointer is in one of the following states:
</p>
<div class="blankline"></div>
<dl><dt>Undefined</dt>
<div class="blankline"></div>
<dd>The pointer is in an invalid state. Dereferencing such a pointer is
an error.</dd>
<div class="blankline"></div>
<dt>Owner</dt>
<div class="blankline"></div>
<dd>The owner is the sole pointer to a memory object graph.
An Owner pointer normally does not have a <span class="d_inlinecode donthyphenate notranslate">scope</span> attribute.
If a pointer with the <span class="d_inlinecode donthyphenate notranslate">scope</span> attribute is initialized
with an expression not derived from a tracked pointer, it is an Owner.
<div class="blankline"></div>
If an Owner pointer is assigned to another Owner pointer, the
former enters the Undefined state.
<div class="blankline"></div>
<pre class="d_code notranslate"><span class="d_keyword">void</span> consume(<span class="d_keyword">int</span>* o); <span class="d_comment">// o is owner
</span>
@live <span class="d_keyword">int</span>* f(<span class="d_keyword">int</span>* p) <span class="d_comment">// p is owner
</span>{
    writeln(*p);
    <span class="d_comment">// transfer ownership to `consume`
</span>    consume(p);
    <span class="d_comment">// p is now undefined
</span>    <span class="d_comment">//writeln(*p); // error
</span>
    <span class="d_keyword">int</span>* q = <span class="d_keyword">new</span> <span class="d_keyword">int</span>; <span class="d_comment">// q is owner
</span>    writeln(*q);
    p = q; <span class="d_comment">// transfer ownership
</span>    <span class="d_comment">// q is now undefined
</span>    <span class="d_comment">//writeln(*q); // error
</span>    writeln(*p);
    <span class="d_keyword">return</span> p;
}
</pre>
</dd>
<div class="blankline"></div>
<dt>Borrowed</dt>
<div class="blankline"></div>
<dd>A Borrowed pointer is one that temporarily becomes the sole live pointer
to a memory object graph. It enters that state via assignment
from an owner pointer or another borrowed pointer, and stays in that state
until its last use.
<div class="blankline"></div>
A Borrowed pointer must be <span class="d_inlinecode donthyphenate notranslate">scope</span> and must
be a pointer to mutable.
A mutable <span class="d_inlinecode donthyphenate notranslate">scope</span> pointer function parameter is a Borrowed pointer.
<div class="blankline"></div>
<pre class="d_code notranslate"><span class="d_keyword">void</span> consume(<span class="d_keyword">int</span>* o); <span class="d_comment">// o is owner
</span><span class="d_keyword">void</span> borrow(<span class="d_keyword">scope</span> <span class="d_keyword">int</span>* b); <span class="d_comment">// b is borrowed
</span>
@live <span class="d_keyword">void</span> g(<span class="d_keyword">scope</span> <span class="d_keyword">int</span>* p) <span class="d_comment">// p is borrowed
</span>{
    <span class="d_comment">//consume(p); // error, p is not owner
</span>    borrow(p);

    <span class="d_comment">// lend p to q
</span>    <span class="d_keyword">int</span>* q = p; <span class="d_comment">// q is inferred as scope
</span>    <span class="d_comment">// &lt;-- using p here would end q's lifetime
</span>    writeln(*q);
    <span class="d_comment">// lifetime of q ends before p is used
</span>    writeln(*p); <span class="d_comment">// OK
</span>}
</pre>
</dd>
<div class="blankline"></div>
<dt>Readonly</dt>
<div class="blankline"></div>
<dd>A Readonly pointer acquires its value from an Owner or Borrowed pointer.
While the Readonly pointer is live, only Readonly pointers can
be acquired from that Owner.
A Readonly pointer must be <span class="d_inlinecode donthyphenate notranslate">scope</span> and also
must not be a pointer to mutable.
<div class="blankline"></div>
<pre class="d_code notranslate">@live <span class="d_keyword">void</span> h(<span class="d_keyword">scope</span> <span class="d_keyword">int</span>* p)
{
    <span class="d_comment">// acquire 2 read only pointers
</span>    <span class="d_keyword">const</span> q = p;
    <span class="d_keyword">const</span> r = q;
    <span class="d_comment">// &lt;-- borrowing or using p here would end q and r's lifetime
</span>
    <span class="d_comment">// both q and r are live
</span>    writeln(*q);
    writeln(*r);
    <span class="d_comment">// using p ends all its read only pointer lifetimes
</span>    writeln(*p);
    <span class="d_comment">//writeln(*q); // error
</span>}
</pre>
</dd>
</dl>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="lifetime" href="#lifetime">Lifetimes</a></h3>
<div class="blankline"></div>
<p>The lifetime of a Borrowed or Readonly pointer value starts when it is
assigned a value from an Owner or another Borrowed pointer, and ends at
the last read of that value.
</p>
<div class="blankline"></div>
<p>This is also known as <i>Non-Lexical Lifetimes</i>.
</p>
<div class="blankline"></div>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="transition" href="#transition">Pointer State Transitions</a></h3>
<div class="blankline"></div>
<p>A pointer changes its state when one of these operations is done to it:
</p>
<div class="blankline"></div>
<ul><li>storage is allocated for it (such as a local variable on the stack),
which places the pointer in the Undefined state</li>
<div class="blankline"></div>
<li>initialization (treated as assignment)</li>
<div class="blankline"></div>
<li>assignment - the source and target pointers change state based on what
states they are in and their types and storage classes</li>
<div class="blankline"></div>
<li>passed to an <span class="d_inlinecode donthyphenate notranslate">out</span> function parameter (changes state after the function returns),
treated the same as initialization</li>
<div class="blankline"></div>
<li>passed by <span class="d_inlinecode donthyphenate notranslate">ref</span> to a function parameter, treated as an assignment to a Borrow or a Readonly
depending on the storage class and type of the parameter</li>
<div class="blankline"></div>
<li>returned from a function</li>
<div class="blankline"></div>
<li>it is passed by value to a function parameter, which is
treated as an assignment to that parameter.</li>
<div class="blankline"></div>
<li>it is implicitly passed by ref as a closure variable to a nested function</li>
<div class="blankline"></div>
<li>the address of the pointer is taken, which is treated as assignment to whoever
receives the address</li>
<div class="blankline"></div>
<li>the address of any part of the memory object graph is taken, which is
treated as assignment to whoever receives that address</li>
<div class="blankline"></div>
<li>a pointer value is read from any part of the memory object graph,
which is treated as assignment to whoever receives that pointer</li>
<div class="blankline"></div>
<li>merging of control flow reconciles the state of each variable based on the
states they have from each edge</li>
</ul>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="borrower" href="#borrower">Borrowers can be Owners</a></h3>
<div class="blankline"></div>
<p>Borrowers are considered Owners if they are initialized from other than
a pointer.
</p>
<div class="blankline"></div>
<pre class="d_code notranslate">@live <span class="d_keyword">void</span> uhoh()
{
    <span class="d_keyword">scope</span> p = malloc();  <span class="d_comment">// p is considered an Owner
</span>    <span class="d_keyword">scope</span> <span class="d_keyword">const</span> pc = malloc(); <span class="d_comment">// pc is not considered an Owner
</span>} <span class="d_comment">// dangling pointer pc is not detected on exit
</span>
</pre>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="exception" href="#exception">Exceptions</a></h3>
<div class="blankline"></div>
<p>The analysis assumes no exceptions are thrown.
</p>
<div class="blankline"></div>
<pre class="d_code notranslate">@live <span class="d_keyword">void</span> leaky()
{
    <span class="d_keyword">auto</span> p = malloc();
    pitcher();  <span class="d_comment">// throws exception, p leaks
</span>    free(p);
}
</pre>
<div class="blankline"></div>
<p>One solution is to use <span class="d_inlinecode donthyphenate notranslate">scope(exit)</span>:
</p>
<div class="blankline"></div>
<pre class="d_code notranslate">@live <span class="d_keyword">void</span> waterTight()
{
    <span class="d_keyword">auto</span> p = malloc();
    <span class="d_keyword">scope</span>(exit) free(p);
    pitcher();
}
</pre>
<div class="blankline"></div>
<p>or use RAII objects or call only <span class="d_inlinecode donthyphenate notranslate">nothrow</span> functions.
</p>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="lazy" href="#lazy">Lazy Parameters</a></h3>
<div class="blankline"></div>
<p>Lazy parameters are not considered.
</p>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="mempool" href="#mempool">Mixing Memory Pools</a></h3>
<div class="blankline"></div>
<p>Conflation of different memory pools:
</p>
<div class="blankline"></div>
<pre class="d_code notranslate"><span class="d_keyword">void</span>* xmalloc(size_t);
<span class="d_keyword">void</span> xfree(<span class="d_keyword">void</span>*);

<span class="d_keyword">void</span>* ymalloc(size_t);
<span class="d_keyword">void</span> yfree(<span class="d_keyword">void</span>*);

<span class="d_keyword">auto</span> p = xmalloc(20);
yfree(p);  <span class="d_comment">// should call xfree() instead
</span></pre>
<p>is not detected.
</p>
<div class="blankline"></div>
<p>This can be mitigated by using type-specific pools:
</p>
<div class="blankline"></div>
<pre class="d_code notranslate">U* umalloc();
<span class="d_keyword">void</span> ufree(U*);

V* vmalloc();
<span class="d_keyword">void</span> vfree(V*);

<span class="d_keyword">auto</span> p = umalloc();
vfree(p);  <span class="d_comment">// type mismatch
</span></pre>
<div class="blankline"></div>
<p>and perhaps disabling implicit conversions to <span class="d_inlinecode donthyphenate notranslate">void*</span> in <span class="d_inlinecode donthyphenate notranslate">@live</span> functions.
</p>
<div class="blankline"></div>
<h3><a class="anchor" title="Permalink to this section" id="vargs" href="#vargs">Variadic Function Arguments</a></h3>
<div class="blankline"></div>
<p>Arguments to variadic functions (such as <span class="d_inlinecode donthyphenate notranslate">printf</span>) are considered to be consumed.
</p>
<div class="blankline"></div>
<div class="blankline"></div>
<h2><a class="anchor" title="Permalink to this section" id="references" href="#references">References</a></h2>
<div class="blankline"></div>
<ol><li><a href="https://bartoszmilewski.com/2009/06/02/race-free-multithreading-ownership">Race-free Multithreading: Ownership</a></li>
</ol>
<div class="blankline"></div>
<div class="blankline"></div>

<div style="float: left"><i class="fa fa-angle-left" aria-hidden="true"></i> <a href="../spec/importc.html">ImportC</a></div>
<div style="float: right"><a href="../spec/windows.html">Windows Programming</a> <i class="fa fa-angle-right" aria-hidden="true"></i></div>
<div style="clear:both"></div>



        <div class="smallprint" id="copyright">Copyright &copy; 1999-2024 by the <a href="../foundation_overview.html">D Language Foundation</a> | Page generated by
<a href="../spec/ddoc.html">Ddoc</a> on (no date time)</div>
    </div>
</div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write('\x3Cscript src="../js/jquery-1.7.2.min.js">\x3C/script>');</script>
    <script type="text/javascript" src="../js/dlang.js"></script>
    
    <script type="text/javascript" src="../js/codemirror-compressed.js"></script>
    <script type="text/javascript" src="../js/run.js"></script>


<script type="text/javascript" src="../js/listanchors.js"></script>
<script type="text/javascript">jQuery(document).ready(addVersionSelector);</script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
</body>
</html>
